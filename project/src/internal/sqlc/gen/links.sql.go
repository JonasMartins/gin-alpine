// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: links.sql

package gen

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const checkIfUserHasResetPasswordLinksAvailable = `-- name: CheckIfUserHasResetPasswordLinksAvailable :one
select ual.link_uuid
from public.users u
    left join public.user_available_links ual on ual.user_id = u.id
    left join public.links l on l.uuid = ual.link_uuid
where 1 = 1
    and ual."type" = 'RESET_PASS'
    and l.deleted_at is null
    and l.expires_at > $2
    and u.email = $1
limit 1
`

type CheckIfUserHasResetPasswordLinksAvailableParams struct {
	Email     string
	ExpiresAt pgtype.Timestamp
}

func (q *Queries) CheckIfUserHasResetPasswordLinksAvailable(ctx context.Context, arg CheckIfUserHasResetPasswordLinksAvailableParams) (pgtype.UUID, error) {
	row := q.db.QueryRow(ctx, checkIfUserHasResetPasswordLinksAvailable, arg.Email, arg.ExpiresAt)
	var link_uuid pgtype.UUID
	err := row.Scan(&link_uuid)
	return link_uuid, err
}

const createLink = `-- name: CreateLink :one
insert into public.links (data, expires_at, uuid)
values ($1, $2, $3)
returning id
`

type CreateLinkParams struct {
	Data      string
	ExpiresAt pgtype.Timestamp
	Uuid      uuid.UUID
}

func (q *Queries) CreateLink(ctx context.Context, arg CreateLinkParams) (int32, error) {
	row := q.db.QueryRow(ctx, createLink, arg.Data, arg.ExpiresAt, arg.Uuid)
	var id int32
	err := row.Scan(&id)
	return id, err
}

const createUserAvailableLinks = `-- name: CreateUserAvailableLinks :one
insert into public.user_available_links (user_id, link_uuid, type)
values ($1, $2, $3)
returning id
`

type CreateUserAvailableLinksParams struct {
	UserID   int32
	LinkUuid uuid.UUID
	Type     LinkType
}

func (q *Queries) CreateUserAvailableLinks(ctx context.Context, arg CreateUserAvailableLinksParams) (int32, error) {
	row := q.db.QueryRow(ctx, createUserAvailableLinks, arg.UserID, arg.LinkUuid, arg.Type)
	var id int32
	err := row.Scan(&id)
	return id, err
}

const deleteLink = `-- name: DeleteLink :exec
update public.links
set deleted_at = $2
where id = $1
`

type DeleteLinkParams struct {
	ID        int32
	DeletedAt pgtype.Timestamp
}

func (q *Queries) DeleteLink(ctx context.Context, arg DeleteLinkParams) error {
	_, err := q.db.Exec(ctx, deleteLink, arg.ID, arg.DeletedAt)
	return err
}

const getLink = `-- name: GetLink :one
SELECT l.id,
    l.uuid,
    l.data,
    l.expires_at,
    l.created_at,
    l.updated_at
FROM public.links l
WHERE 1 = 1
    AND l.uuid = $1
    AND l.deleted_at is null
limit 1
`

type GetLinkRow struct {
	ID        int32
	Uuid      uuid.UUID
	Data      string
	ExpiresAt pgtype.Timestamp
	CreatedAt pgtype.Timestamp
	UpdatedAt pgtype.Timestamp
}

func (q *Queries) GetLink(ctx context.Context, argUuid uuid.UUID) (GetLinkRow, error) {
	row := q.db.QueryRow(ctx, getLink, argUuid)
	var i GetLinkRow
	err := row.Scan(
		&i.ID,
		&i.Uuid,
		&i.Data,
		&i.ExpiresAt,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
